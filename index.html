<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gato.TV Panel</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;500;700;900&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Press+Start+2P&family=Permanent+Marker&family=Courier+Prime&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

<style>
    :root { 
        --bg: #020617;        
        --panel: #0f172a;     
        --accent: #38bdf8; 
        --accent-glow: rgba(56, 189, 248, 0.6); 
        --twitch: #9146ff; 
        --yellow: #facc15; 
        --text: #f8fafc;      
        --text-muted: #94a3b8; 
        --border: #1e293b;    
        --border-hover: #334155;
        --danger: #ef4444; 
        --success: #22c55e;
        --tier1: #94a3b8;
        --tier2: #38bdf8;
        --tier3: #facc15;
    }
    * { box-sizing: border-box; }
    
    body { 
        margin: 0; 
        font-family: 'Outfit', sans-serif; 
        background: linear-gradient(to bottom, #0f172a, var(--bg)); 
        color: var(--text); 
        min-height: 100vh; 
        padding-bottom: 50px; 
        overflow-x: hidden; 
    }
    
    /* HEADER */
    header { 
        background: #0f172a; 
        height: 60px; 
        display: flex; 
        align-items: center; 
        justify-content: space-between; 
        padding: 0 30px; 
        border-bottom: 1px solid var(--border); 
        position: sticky; 
        top: 0; 
        z-index: 100; 
        box-shadow: 0 4px 20px rgba(0,0,0,0.4); 
    }
    
    .header-left { display: flex; align-items: center; gap: 20px; flex: 1; }
    
    .logo { 
        font-size: 22px; 
        font-weight: 900; 
        color: var(--accent); 
        letter-spacing: -0.5px; 
        text-transform: uppercase; 
        text-shadow: 0 0 15px var(--accent-glow); 
        cursor: pointer; 
        display: flex; 
        align-items: center; 
        gap: 8px; 
        white-space: nowrap; 
        transition: 0.2s; 
    }
    .logo:hover { transform: scale(1.02); }
    
    .beta-tag { font-size: 9px; background: var(--danger); color: white; padding: 2px 6px; border-radius: 4px; font-weight: 700; transform: translateY(-2px); box-shadow: 0 0 10px rgba(239, 68, 68, 0.4); }
    
    .btn-login-header { background: var(--twitch); color: white; border: none; padding: 7px 20px; border-radius: 8px; font-weight: 700; font-size: 13px; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; box-shadow: 0 0 15px rgba(145, 70, 255, 0.15); }
    .btn-login-header:hover { background: #772ce8; transform: translateY(-1px); box-shadow: 0 0 20px rgba(145, 70, 255, 0.3); }
    
    .coin-display { display: flex; align-items: center; gap: 8px; background: rgba(15, 23, 42, 0.5); border: 1px solid var(--border); color: var(--yellow); padding: 5px 12px; border-radius: 8px; font-weight: 800; font-size: 13px; margin-right: 15px; white-space: nowrap; box-shadow: inset 0 0 10px rgba(0,0,0,0.2); }
    
    .search-container { position: relative; width: 280px; margin-left: 15px; display: none; }
    .search-input { width: 100%; background: #1e293b; border: 1px solid var(--border); color: white; padding: 8px 15px 8px 38px; border-radius: 50px; font-family: 'Outfit', sans-serif; font-size: 13px; transition: 0.2s; outline: none; }
    .search-input:focus { border-color: var(--accent); background: #0f172a; box-shadow: 0 0 15px rgba(56, 189, 248, 0.15); }
    .search-icon { position: absolute; left: 14px; top: 50%; transform: translateY(-50%); color: var(--text-muted); font-size: 13px; pointer-events: none; }
    
    nav { display: flex; gap: 6px; background: transparent; padding: 0; }
    nav button { background: transparent; border: 1px solid transparent; color: var(--text-muted); font-size: 13px; font-weight: 600; padding: 7px 14px; cursor: pointer; border-radius: 8px; transition: 0.2s; }
    nav button:hover { color: #fff; background: rgba(255,255,255,0.03); border-color: var(--border); }
    nav button.active { background: #1e293b; color: white; font-weight: 700; border: 1px solid var(--border-hover); box-shadow: 0 2px 10px rgba(0,0,0,0.2); }
    nav button.btn-purple.active { background: var(--twitch); color: white; border-color: var(--twitch); box-shadow: 0 0 20px rgba(145, 70, 255, 0.25); }
    nav button.btn-yellow.active { background: var(--yellow); color: black; border-color: var(--yellow); box-shadow: 0 0 20px rgba(250, 204, 21, 0.25); }
    
    .container { width: 100%; max-width: 96%; margin: 30px auto; padding: 0 15px; }
    .panel { display: none; animation: fadeIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); }
    .panel.active { display: block; }
    @keyframes fadeIn { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
    
    .login-blocker { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 100px 20px; background: var(--panel); border: 1px solid var(--border); border-radius: 20px; margin-top: 40px; box-shadow: 0 20px 50px rgba(0,0,0,0.3); text-align: center; background-image: radial-gradient(circle at center, #1e293b 0%, #0f172a 100%); }
    .login-blocker h2 { font-size: 32px; margin-bottom: 15px; color: white; letter-spacing: -1px; }
    
    .profile-header { position: relative; margin-bottom: 20px; background: var(--panel); border: 1px solid var(--border); border-radius: 24px; overflow: hidden; margin-top: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.25); }
    .profile-banner { height: 170px; background: url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2072&auto=format&fit=crop') center/cover; position: relative; }
    .profile-banner::after { content:''; position: absolute; bottom:0; left:0; width:100%; height:100%; background: linear-gradient(to top, var(--panel) 0%, rgba(15, 23, 42, 0.5) 50%, transparent 100%); }
    .profile-meta-container { position: absolute; bottom: 20px; left: 40px; display: flex; align-items: center; gap: 20px; z-index: 10; width: auto; }
    .profile-avatar-big { width: 80px; height: 80px; border-radius: 50%; border: 3px solid var(--panel); background: #000; box-shadow: 0 5px 20px rgba(0,0,0,0.5); }
    .profile-info-block { display: flex; flex-direction: column; justify-content: center; margin: 0; }
    .profile-name-big { font-size: 26px; font-weight: 900; color: white; text-shadow: 0 2px 20px rgba(0,0,0,0.8); line-height: 1.1; display: flex; align-items: center; gap: 10px; letter-spacing: -0.5px; }
    .profile-role-tag { font-size: 10px; color: var(--accent); font-weight: 800; text-transform: uppercase; letter-spacing: 1px; background: rgba(56, 189, 248, 0.15); padding: 3px 8px; border-radius: 6px; display: inline-block; margin-top: 4px; border: 1px solid rgba(56, 189, 248, 0.3); backdrop-filter: blur(4px); }
    .viewing-badge { font-size: 10px; background: var(--yellow); color: black; padding: 2px 8px; border-radius: 20px; vertical-align: middle; font-weight: 800; }
    
    .profile-nav-centered { position: absolute; bottom: 15px; left: 50%; transform: translateX(-50%); display: flex; gap: 8px; background: rgba(2, 6, 23, 0.7); padding: 5px; border-radius: 14px; backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.05); z-index: 20; }
    .profile-nav-centered button { background: transparent; border: none; color: #cbd5e1; font-size: 12px; font-weight: 600; padding: 6px 16px; border-radius: 10px; cursor: pointer; transition: 0.2s; display: flex; align-items: center; gap: 6px; }
    .profile-nav-centered button:hover { background: rgba(255,255,255,0.1); color: white; }
    .profile-nav-centered button.active { background: var(--twitch); color: white; box-shadow: 0 4px 15px rgba(145, 70, 255, 0.3); font-weight: 800; }
    .back-to-me-btn { position: absolute; top: 15px; right: 20px; background: rgba(0,0,0,0.6); color: white; border: 1px solid rgba(255,255,255,0.1); padding: 6px 14px; border-radius: 8px; cursor: pointer; font-weight: bold; backdrop-filter: blur(5px); transition: 0.2s; z-index: 10; display: none; font-size: 11px; }
    .back-to-me-btn:hover { background: var(--twitch); border-color: var(--twitch); }

    .profile-content-area { padding: 30px; }
    .profile-section-title { font-size: 18px; font-weight: 800; color: white; margin-bottom: 20px; border-left: 4px solid var(--twitch); padding-left: 15px; display: flex; align-items: center; gap: 10px; letter-spacing: -0.5px; }
    
    .chat-preview-container { max-width: 600px; margin: 0 auto 30px auto; background: #020617; border: 1px solid var(--border); border-radius: 12px; padding: 15px 25px; font-family: 'Inter', sans-serif; display: flex; align-items: center; justify-content: space-between; position: relative; z-index: 10; flex-wrap: wrap; gap: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.3); }
    .chat-preview-container.light { background: #f8fafc; border-color: #cbd5e1; }
    .chat-preview-container.light .chat-msg { color: #0f172a; }
    .chat-preview-container.light .chat-time { color: #64748b; }
    .chat-line { display: flex; align-items: center; font-size: 14px; flex-wrap: wrap; }
    .chat-time { margin-right: 12px; color: #64748b; font-size: 12px; font-weight: 500; }
    .chat-username { font-weight: 700; color: #22c55e; margin-right: 5px; white-space: nowrap; }
    .chat-msg { color: #e2e8f0; word-break: break-word; }
    .gato-badge-preview { width: 18px; height: 18px; border-radius: 3px; vertical-align: middle; margin-right: 4px; }
    .toggle-theme-btn { background: var(--panel); border: 1px solid var(--border); color: var(--text-muted); padding: 6px 12px; border-radius: 8px; cursor: pointer; transition: 0.2s; }
    .toggle-theme-btn:hover { color: white; border-color: var(--text-muted); }

    .btn-primary { background: var(--twitch); color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; box-shadow: 0 4px 15px rgba(145,70,255,0.25); }
    .btn-primary:hover { background: #772ce8; transform: translateY(-1px); box-shadow: 0 6px 20px rgba(145,70,255,0.35); }
    .btn-primary.small { font-size: 12px; padding: 8px 16px; }
    .btn-outline { background: transparent; border: 1px solid var(--border); color: var(--text); padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; transition: 0.2s; }
    .btn-outline:hover { border-color: var(--accent); color: var(--accent); background: rgba(56,189,248,0.05); }
    .btn-secondary { background: #334155; color: white; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 700; cursor: pointer; }
    .btn-secondary:hover { background: #475569; }

    .preset-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(210px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .preset-card { background: var(--panel); border: 1px solid var(--border); border-radius: 16px; padding: 8px; cursor: pointer; text-align: center; transition: 0.2s; position: relative; overflow: hidden; display: flex; flex-direction: column; box-shadow: 0 4px 10px rgba(0,0,0,0.2); }
    .preset-card:hover { border-color: var(--text-muted); transform: translateY(-4px); box-shadow: 0 15px 30px rgba(0,0,0,0.4); }
    .preset-card.owned { border-color: var(--success); background: rgba(34, 197, 94, 0.03); }
    .preset-card .card-preview { padding: 40px 10px; font-size: 22px; font-weight: 900; display:flex; align-items:center; justify-content:center; height: 120px; background: #020617; border-radius: 12px 12px 0 0; border: 1px solid rgba(255,255,255,0.03); }
    .preset-card .card-info { background: var(--panel); padding: 15px; border-radius: 0 0 12px 12px; display: flex; flex-direction: column; gap: 10px; flex: 1; justify-content: flex-end; }
    .preset-card .preset-name { font-size: 13px; text-transform: uppercase; letter-spacing: 1px; color: var(--text-muted); font-weight: 700; display: block; }

    .inventory-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(170px, 1fr)); gap: 12px; margin-bottom: 30px; } 
    .inventory-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 6px; cursor: pointer; transition: 0.2s; position: relative; overflow: hidden; display: flex; flex-direction: row; height: 75px; align-items: center; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    .inventory-card:hover { border-color: var(--text-muted); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.3); }
    .inventory-card.owned { border-color: var(--success); background: rgba(34, 197, 94, 0.03); }
    .inventory-card .card-preview { height: 100%; width: 55px; padding: 5px; font-size: 16px; font-weight: 900; display:flex; align-items:center; justify-content:center; border-right: 1px solid var(--border); flex-shrink: 0; background: rgba(0,0,0,0.2); border-radius: 8px 0 0 8px; }
    .inventory-card .card-info { background: transparent; padding: 0 0 0 12px; display: flex; flex-direction: column; justify-content: center; flex: 1; align-items: flex-start; height: 100%; }
    .inventory-card .preset-name { font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); font-weight: 700; display: block; margin-bottom: 6px; text-align: left; overflow: hidden; white-space: nowrap; text-overflow: ellipsis; max-width: 90px; }

    .empty-state-styled { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 40px; color: var(--text-muted); gap: 15px; border: 2px dashed var(--border); border-radius: 12px; background: rgba(15, 23, 42, 0.3); }
    .empty-state-styled i { font-size: 32px; color: var(--border-hover); }
    .empty-state-styled span { font-weight: 700; font-size: 13px; text-transform: uppercase; letter-spacing: 1px; }

    .btn-action { width: 100%; padding: 10px; border-radius: 8px; border: none; font-weight: 800; cursor: pointer; font-size: 11px; text-transform: uppercase; letter-spacing: 0.5px; }
    .inventory-card .btn-action { width: auto; padding: 5px 10px; font-size: 10px; border-radius: 6px; }

    .btn-buy { background: var(--yellow); color: #000; box-shadow: 0 4px 10px rgba(250, 204, 21, 0.2); }
    .btn-buy:hover { background: #fbbf24; }
    .btn-equip { background: var(--success); color: #000; box-shadow: 0 4px 10px rgba(34, 197, 94, 0.2); }
    .btn-equip:hover { background: #4ade80; }
    .btn-unequip { background: var(--danger); color: #fff; box-shadow: 0 4px 10px rgba(239, 68, 68, 0.2); }
    .btn-unequip:hover { background: #f87171; }

    .category-badge { position: absolute; top:5px; left:5px; padding:3px 6px; border-radius:4px; font-size:9px; font-weight:bold; text-transform:uppercase; color:white; z-index: 2; pointer-events: none; box-shadow: 0 2px 5px rgba(0,0,0,0.3); }
    .cat-paint { background: #38bdf8; } .cat-badge { background: #9146ff; } .cat-ink { background: #f43f5e; } .cat-font { background: #10b981; } .cat-bg { background: #f59e0b; }
    .shop-section-title { width: 100%; font-size: 14px; font-weight: 800; color: var(--accent); margin: 35px 0 15px 0; text-transform: uppercase; letter-spacing: 1px; border-bottom: 1px solid var(--border); padding-bottom: 10px; }
    
    .emotes-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr)); gap: 15px; margin-top: 25px; }
    .emote-card { background: var(--panel); border: 1px solid var(--border); border-radius: 12px; padding: 20px; text-align: center; position: relative; transition: 0.2s; cursor: pointer; display: flex; flex-direction: column; align-items: center; min-height: 130px; justify-content: center; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
    .emote-card:hover { transform: translateY(-4px); border-color: var(--accent); box-shadow: 0 10px 20px rgba(0,0,0,0.3); }
    .emote-card img { height: 50px; width: auto; max-width: 100%; object-fit: contain; margin-bottom: 12px; display: block; filter: drop-shadow(0 4px 6px rgba(0,0,0,0.3)); }
    .emote-card .name { font-weight: 700; font-size: 13px; color: white; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; width: 100%; }
    .emote-card .author { font-size: 10px; color: var(--text-muted); margin-top: 5px; }
    .action-overlay { position: absolute; top: 6px; right: 6px; width: 24px; height: 24px; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-weight: bold; cursor: pointer; opacity: 0; transition: 0.2s; font-size: 12px; color: white; z-index: 2; }
    .emote-card:hover .action-overlay { opacity: 1; }
    .del-btn { background: var(--danger); box-shadow: 0 2px 8px rgba(239,68,68,0.4); }
    
    .emote-sub-nav { display:flex; gap:10px; margin-bottom:20px; }
    .emote-sub-nav button { background: var(--panel); border: 1px solid var(--border); color: var(--text-muted); padding: 8px 18px; border-radius: 8px; cursor: pointer; font-weight: 600; font-size: 13px; transition: 0.2s; }
    .emote-sub-nav button:hover { background: #1e293b; color: white; }
    .emote-sub-nav button.active { background: var(--accent); color: #020617; border-color: var(--accent); font-weight: 800; box-shadow: 0 0 15px var(--accent-glow); }
    
    .modal-wrap { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(2, 6, 23, 0.95); backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; }
    .modal-box { background: #0f172a; border: 1px solid var(--border); width: 90%; max-width: 420px; border-radius: 24px; overflow: hidden; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); box-shadow: 0 20px 60px rgba(0,0,0,0.6); }
    @keyframes popIn { from { transform: scale(0.95); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    .modal-head { background: #1e293b; padding: 35px; text-align: center; border-bottom: 1px solid var(--border); position: relative; }
    .modal-close { position: absolute; top: 20px; right: 25px; background: none; border: none; color: #94a3b8; font-size: 26px; cursor: pointer; transition: 0.2s; }
    .modal-close:hover { color: white; }
    .modal-content { padding: 35px; text-align: center; }
    .modal-btn { width: 100%; padding: 16px; border-radius: 14px; font-weight: 800; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; margin-top: 15px; font-size: 14px; }
    
    .btn-daily { margin-left: auto; background: linear-gradient(45deg, #facc15, #f59e0b); color: #000; border: none; border-radius: 50px; padding: 8px 20px; font-size: 12px; font-weight: 900; cursor: pointer; box-shadow: 0 0 20px rgba(250, 204, 21, 0.3); display: flex; align-items: center; gap: 8px; width: auto; justify-content: center; transition: 0.2s; }
    .btn-daily:hover { transform: translateY(-1px); box-shadow: 0 0 30px rgba(250, 204, 21, 0.5); }
    .btn-daily:disabled { background: #334155; color: #94a3b8; cursor: not-allowed; box-shadow: none; transform: none; }
    
    .redeem-btn { position: fixed; bottom: 30px; right: 30px; background: linear-gradient(135deg, #ef4444, #f43f5e); color: white; padding: 14px 28px; border-radius: 50px; font-weight: 800; cursor: pointer; box-shadow: 0 10px 25px rgba(239, 68, 68, 0.3); z-index: 999; display: none; align-items: center; gap: 10px; transition: 0.2s; font-size: 14px; border: 2px solid rgba(255,255,255,0.1); }
    .redeem-btn:hover { transform: translateY(-3px); box-shadow: 0 15px 35px rgba(239, 68, 68, 0.5); }
    
    .wip-container { display: flex; align-items: center; justify-content: center; min-height: 400px; }
    .wip-icon { font-size: 80px; color: #1e293b; animation: pulse 2s infinite; }
    @keyframes pulse { 0% { transform: scale(1); opacity: 0.3; } 50% { transform: scale(1.1); opacity: 0.7; } 100% { transform: scale(1); opacity: 0.3; } }
    
    .hero-card { background: linear-gradient(135deg, rgba(56, 189, 248, 0.08), rgba(0,0,0,0)); border: 1px solid var(--border); border-radius: 24px; padding: 80px 40px; text-align: center; margin-top: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.2); }
    .hero-card h1 { font-size: 42px; font-weight: 900; margin-bottom: 15px; background: linear-gradient(90deg, #fff, #94a3b8); -webkit-background-clip: text; color: transparent; letter-spacing: -1px; }
    .btn-download-big { background: var(--yellow); color: #000; font-size: 18px; font-weight: 900; padding: 18px 45px; border: none; border-radius: 14px; cursor: pointer; text-transform: uppercase; letter-spacing: 1px; margin-top: 30px; box-shadow: 0 10px 30px rgba(250, 204, 21, 0.3); transition: 0.2s; }
    .btn-download-big:hover { transform: translateY(-3px); box-shadow: 0 20px 50px rgba(250, 204, 21, 0.4); }
    
    .info-block { margin-top: 80px; border-top: 1px solid var(--border); padding-top: 50px; text-align: left; }
    .info-grid-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(320px, 1fr)); gap: 30px; }
    .info-item { background: var(--panel); padding: 35px; border-radius: 16px; border: 1px solid var(--border); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
    .info-item h3 { color: white; margin-top: 0; font-size: 20px; }
    
    .emote-form-container { background: var(--panel); border: 1px solid var(--border); border-radius: 20px; padding: 40px; box-shadow: 0 10px 40px rgba(0,0,0,0.2); }
    .emote-form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-bottom: 25px; }
    .form-group { display: flex; flex-direction: column; gap: 10px; }
    .form-group.full-width { grid-column: span 2; }
    label { font-size: 12px; font-weight: 800; color: var(--text-muted); text-transform: uppercase; letter-spacing: 1px; margin-left: 2px; }
    input, select { padding: 16px; background: #020617; border: 1px solid var(--border); color: white; border-radius: 10px; font-size: 14px; width: 100%; outline: none; transition: 0.2s; }
    input:focus, select:focus { border-color: var(--accent); box-shadow: 0 0 0 3px rgba(56, 189, 248, 0.1); }
    .file-drop-zone { border: 2px dashed var(--border); background: rgba(2, 6, 23, 0.5); border-radius: 14px; padding: 30px; text-align: center; cursor: pointer; position: relative; transition: 0.2s; }
    .file-drop-zone:hover { border-color: var(--accent); background: rgba(56, 189, 248, 0.05); }
    .file-drop-zone input[type=file] { position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; cursor: pointer; }
    
    .manage-section { background: var(--panel); border: 1px solid var(--border); border-radius: 20px; padding: 30px; margin-bottom: 30px; }
    .manage-header { font-size: 20px; font-weight: 800; color: white; margin-bottom: 20px; display:flex; align-items:center; gap:10px; }
    .mod-item { display: flex; justify-content: space-between; align-items: center; background: #020617; padding: 15px; border-radius: 10px; border: 1px solid var(--border); font-size: 14px; font-weight: 600; }
    .btn-remove-mod { background: rgba(239, 68, 68, 0.1); color: var(--danger); border: none; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 12px; font-weight: 700; transition: 0.2s; }
    .btn-remove-mod:hover { background: rgba(239, 68, 68, 0.2); }
    
    .fixed-bottom-controls { position: fixed; bottom: 90px; left: 25px; display: none; gap: 10px; z-index: 999; align-items: center; }
    .role-badge, .connections-btn { height: 28px; display: flex; align-items: center; justify-content: center; padding: 0 12px; border-radius: 6px; font-size: 11px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.5px; border: 1px solid var(--border); background: #0f172a; box-shadow: 0 4px 12px rgba(0,0,0,0.3); transition: 0.2s; }
    .role-user { border-color: rgba(34, 197, 94, 0.3); color: var(--success); }
    .role-admin { border-color: rgba(239, 68, 68, 0.3); color: var(--danger); }
    .connections-btn { color: var(--text-muted); cursor: pointer; text-decoration: none; }
    .connections-btn:hover { border-color: var(--accent); color: white; transform: translateY(-2px); box-shadow: 0 4px 15px rgba(56, 189, 248, 0.2); }
    .btn-login { background: var(--twitch); color: white; border: none; padding: 10px 24px; border-radius: 10px; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: 0.2s; box-shadow: 0 0 20px rgba(145, 70, 255, 0.2); font-size: 14px; }
    .btn-login:hover { background: #772ce8; transform: translateY(-2px); box-shadow: 0 0 30px rgba(145, 70, 255, 0.4); }

    .user-profile-floater { position: fixed; bottom: 20px; left: 20px; z-index: 900; display: none; align-items: center; gap: 12px; background: rgba(15, 23, 42, 0.9); border: 1px solid var(--border); padding: 8px 15px 8px 8px; border-radius: 50px; backdrop-filter: blur(10px); box-shadow: 0 10px 30px rgba(0,0,0,0.4); transition: transform 0.2s; }
    .user-profile-floater:hover { transform: translateY(-3px); border-color: var(--accent); box-shadow: 0 10px 40px rgba(56, 189, 248, 0.15); }
    .floater-avatar { width: 38px; height: 38px; border-radius: 50%; border: 2px solid var(--twitch); }
    .floater-info { display: flex; flex-direction: column; line-height: 1.1; }
    .floater-name { font-weight: 700; color: white; font-size: 13px; }
    .btn-logout-mini { background: none; border: none; color: var(--text-muted); font-size: 10px; cursor: pointer; padding: 0; text-align: left; font-weight: 600; transition: color 0.2s; }
    .btn-logout-mini:hover { color: var(--danger); }

    /* PET SYSTEM STYLES */
    .pet-slots-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; }
    .pet-slot-selector { width: 60px; height: 60px; border-radius: 50%; background: #1e293b; border: 2px solid var(--border); display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s; position: relative; }
    .pet-slot-selector.active { border-color: var(--accent); box-shadow: 0 0 15px var(--accent-glow); transform: scale(1.1); background: #0f172a; }
    .pet-slot-selector i { color: #555; font-size: 20px; }
    .pet-slot-content { font-size: 24px; }
    
    .pet-stage-wrapper { position: relative; width: 100%; max-width: 500px; margin: 0 auto 30px auto; height: 320px; display: flex; align-items: center; justify-content: center; }
    
    /* Equip slots */
    .equip-slot { width: 45px; height: 45px; background: rgba(15, 23, 42, 0.8); border: 1px solid var(--border); border-radius: 8px; display: flex; align-items: center; justify-content: center; position: absolute; color: var(--text-muted); font-size: 18px; cursor: pointer; transition: 0.2s; z-index: 5; }
    .equip-slot:hover { border-color: var(--accent); color: white; }
    .equip-slot.has-item { border-color: var(--yellow); color: var(--yellow); background: rgba(250, 204, 21, 0.1); }
    .slot-head { top: 10px; left: 50%; transform: translateX(-50%); }
    .slot-chest { top: 50%; left: 20px; transform: translateY(-50%); }
    .slot-wep { top: 50%; right: 20px; transform: translateY(-50%); }
    .slot-legs { bottom: 10px; left: 50%; transform: translateX(-50%); }

    .pet-stage { width: 100%; height: 100%; background: radial-gradient(circle at center, #1e293b 0%, #020617 70%); border: 1px solid var(--border); border-radius: 20px; display: flex; flex-direction: column; align-items: center; justify-content: center; box-shadow: inset 0 0 50px rgba(0,0,0,0.5); z-index: 1; }
    .pet-avatar { font-size: 80px; filter: drop-shadow(0 0 20px var(--accent-glow)); animation: floatPet 3s ease-in-out infinite; margin-bottom: 10px; transition: color 0.3s; }
    
    .pet-tier-1 { color: var(--tier1); }
    .pet-tier-2 { color: var(--tier2); filter: drop-shadow(0 0 15px var(--tier2)); }
    .pet-tier-3 { color: var(--tier3); filter: drop-shadow(0 0 20px var(--tier3)); }

    @keyframes floatPet { 0% { transform: translateY(0); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0); } }
    .pet-info { position: relative; z-index: 2; width: 100%; max-width: 250px; text-align: center; }
    .pet-name { font-size: 20px; font-weight: 900; color: white; margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
    .pet-level-badge { background: var(--yellow); color: black; font-size: 10px; padding: 2px 6px; border-radius: 4px; font-weight: 800; vertical-align: middle; margin-left: 8px; }
    .pet-stats-bar { height: 6px; background: #334155; border-radius: 4px; overflow: hidden; margin-top: 5px; position: relative; }
    .pet-stats-fill { height: 100%; background: linear-gradient(90deg, #38bdf8, #22c55e); width: 0%; transition: width 0.5s; }
    
    .btn-expedition { margin-top: 15px; background: linear-gradient(45deg, #f59e0b, #ef4444); border: none; padding: 10px 24px; border-radius: 8px; color: white; font-weight: 800; font-size: 13px; cursor: pointer; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); width: 100%; transition: 0.2s; }
    .btn-expedition:hover { transform: translateY(-2px); filter: brightness(1.1); }
    .btn-evolve { margin-top: 8px; background: linear-gradient(45deg, #8b5cf6, #d946ef); border: none; padding: 8px 20px; border-radius: 8px; color: white; font-weight: 800; font-size: 11px; cursor: pointer; width: 100%; }

    .pets-inventory-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(70px, 1fr)); gap: 10px; margin-top: 20px; padding-top: 20px; border-top: 1px solid var(--border); }
    .inv-pet-item { background: #1e293b; border: 1px solid var(--border); border-radius: 10px; padding: 10px; text-align: center; cursor: pointer; transition: 0.2s; position: relative; }
    .inv-pet-item:hover { border-color: var(--accent); transform: translateY(-2px); }
    .inv-pet-item.selected { border-color: var(--success); box-shadow: 0 0 10px rgba(34, 197, 94, 0.3); }
    .inv-pet-icon { font-size: 24px; margin-bottom: 5px; }
    .inv-pet-lvl { font-size: 9px; color: var(--text-muted); font-weight: 700; }
    .inv-pet-tier { position: absolute; top: 2px; right: 4px; font-size: 8px; font-weight: 900; }

    .btn-petsdex { width: 100%; background: #1e293b; border: 1px solid var(--border); padding: 15px; border-radius: 12px; color: var(--text-muted); font-weight: 800; cursor: pointer; display: flex; justify-content: space-between; align-items: center; transition: 0.2s; margin-top: 20px; }
    .btn-petsdex:hover { color: white; border-color: var(--accent); background: #0f172a; }

    .egg-shop-section { display: flex; gap: 20px; justify-content: center; flex-wrap: wrap; margin-bottom: 40px; margin-top: 20px; }
    .egg-card { background: var(--panel); border: 1px solid var(--border); padding: 20px; border-radius: 16px; text-align: center; width: 200px; transition: 0.2s; cursor: pointer; position: relative; }
    .egg-card:hover { transform: translateY(-5px); border-color: var(--yellow); box-shadow: 0 0 20px rgba(250, 204, 21, 0.2); }
    .egg-icon { font-size: 40px; color: var(--text-muted); margin-bottom: 15px; }
    .egg-title { font-weight: 800; color: white; font-size: 14px; margin-bottom: 5px; }
    .egg-price { color: var(--yellow); font-weight: 700; font-size: 12px; }
    .odds-display { font-size: 10px; color: var(--text-muted); margin-top: 10px; text-align: left; line-height: 1.4; }
    
    .pokedex-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(80px, 1fr)); gap: 10px; margin-top: 15px; display: none; } 
    .pokedex-item { background: rgba(15, 23, 42, 0.5); border: 1px solid var(--border); border-radius: 8px; padding: 15px; text-align: center; opacity: 0.5; transition: 0.2s; }
    .pokedex-item.unlocked { opacity: 1; border-color: var(--accent); background: rgba(56, 189, 248, 0.05); }
    .pokedex-icon { font-size: 24px; margin-bottom: 5px; }
    .pokedex-name { font-size: 9px; font-weight: 700; text-transform: uppercase; }
    .rarity-common { color: var(--tier1); }
    .rarity-rare { color: var(--tier2); }
    .rarity-legendary { color: var(--tier3); text-shadow: 0 0 10px rgba(250, 204, 21, 0.5); }

    /* Expedition Modal */
    .expedition-grid { display: grid; gap: 10px; margin-top: 15px; }
    .exp-option { background: #1e293b; border: 1px solid var(--border); padding: 15px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; transition: 0.2s; }
    .exp-option:hover { border-color: var(--accent); background: #0f172a; }
    .exp-info h4 { margin: 0; color: white; font-size: 14px; }
    .exp-info p { margin: 5px 0 0; font-size: 11px; color: var(--text-muted); }
    .exp-meta { text-align: right; font-size: 11px; font-weight: 700; }
    .exp-timer-display { font-size: 24px; font-weight: 900; color: var(--yellow); letter-spacing: 2px; margin: 10px 0; }

    /* Item Inventory Modal */
    .item-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 10px; }
    .item-card { background: #0f172a; border: 1px solid var(--border); padding: 10px; border-radius: 8px; text-align: center; cursor: pointer; }
    .item-card:hover { border-color: var(--accent); }
    .item-card i { font-size: 20px; color: var(--accent); margin-bottom: 5px; }
    .item-card span { display: block; font-size: 9px; color: #ccc; }

    .hidden { display: none !important; }
</style>
</head>
<body>

<header>
    <div class="header-left">
        <div class="logo" onclick="location.reload()">Gato.TV <span class="beta-tag">BETA</span></div>
        <div id="loginBtnContainer">
            <button class="btn-login-header" onclick="loginWithTwitch()">Zaloguj</button>
        </div>
        <div class="search-container" id="searchContainer" style="display:none;">
            <i class="fas fa-search search-icon"></i>
            <input type="text" id="userSearchInput" class="search-input" placeholder="Szukaj profilu...">
        </div>
    </div>
    <div style="display:flex; align-items:center;">
        <div id="coinDisplay" class="coin-display" style="display:none;">
            <i class="fas fa-coins"></i> <span id="coinCount">10</span>
        </div>
        <nav>
            <button class="active" onclick="switchTab('profile')">Profile</button>
            <button onclick="switchTab('pets')">Pets</button>
            <button onclick="switchTab('shop')">Shop</button>
            <button onclick="switchTab('emotes')">Emotes</button>
            <button class="btn-purple" onclick="switchTab('premium')">Premium</button>
            <button class="btn-yellow" onclick="switchTab('download')">Download</button>
        </nav>
    </div>
</header>

<div class="container">

    <!-- PROFILE TAB -->
    <div id="profile" class="panel active">
        <div class="login-blocker"><h2>üîí Wymagane Logowanie</h2><button class="btn-login" onclick="loginWithTwitch()">Zaloguj przez Twitch</button></div>
        <div class="protected-content">
            <div class="profile-header">
                <button id="btnBackToMe" class="back-to-me-btn" onclick="returnToMyProfile()">WR√ìƒÜ DO SIEBIE</button>
                <div class="profile-banner">
                    <div class="profile-nav-centered">
                        <button id="pTabInv" class="active" onclick="switchProfileSubTab('inventory')"><i class="fas fa-backpack"></i> Ekwipunek</button>
                        <button id="pTabCh" onclick="switchProfileSubTab('channel')"><i class="fas fa-tv"></i> My Channel Emotes</button>
                    </div>
                </div>
                <div class="profile-meta-container">
                    <img id="profileAvatarBig" class="profile-avatar-big" src="">
                    <div class="profile-info-block">
                        <div class="profile-name-row" style="display:flex; align-items:center; gap:10px;">
                            <div id="profileNameBig" class="profile-name-big">...</div>
                            <span id="viewingBadge" class="viewing-badge" style="display:none;">PODGLƒÑD</span>
                        </div>
                        <div style="display:flex; align-items:center; gap:15px;">
                            <div id="profileRoleTag" class="profile-role-tag">USER</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="profile-content-area">
                <div class="chat-preview-container" onclick="togglePreviewTheme(this)">
                    <div class="chat-line">
                        <span class="chat-time">12:30</span>
                        <span class="chat-badges preview-badges"></span>
                        <span class="chat-username preview-user">Tw√≥jNick</span><span style="margin-right:4px;">:</span><span class="chat-msg">Gato.TV zmienia Tw√≥j czat! üê±</span>
                    </div>
                    <span style="font-size:10px; color:#64748b; margin-left:auto; cursor:pointer;">(Kliknij aby zmieniƒá motyw)</span>
                </div>

                <div id="profileInventory" style="display:block;">
                    <div class="profile-section-title"><i class="fas fa-paint-brush"></i> Twoje Przedmioty</div>
                    <div id="profileInvGrid" class="inventory-grid"></div>
                </div>
                <div id="profileChannel" style="display:none;">
                    <div class="profile-section-title"><i class="fas fa-hashtag"></i> Przypisane do Kana≈Çu</div>
                    <div id="profileChannelGrid" class="emotes-grid"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- PETS TAB -->
    <div id="pets" class="panel">
        <div class="protected-content">
            <!-- 3 SLOTS SELECTOR -->
            <div class="pet-slots-container">
                <div id="slot0" class="pet-slot-selector active" onclick="selectPetSlot(0)"><i class="fas fa-plus"></i></div>
                <div id="slot1" class="pet-slot-selector" onclick="selectPetSlot(1)"><i class="fas fa-plus"></i></div>
                <div id="slot2" class="pet-slot-selector" onclick="selectPetSlot(2)"><i class="fas fa-plus"></i></div>
            </div>

            <!-- MAIN PET STAGE -->
            <div class="pet-stage-wrapper">
                <div class="equip-slot slot-head" onclick="openItemModal('head')" title="Czapka"><i class="fas fa-hat-wizard"></i></div>
                <div class="equip-slot slot-chest" onclick="openItemModal('chest')" title="Napiersnik"><i class="fas fa-tshirt"></i></div>
                <div class="equip-slot slot-wep" onclick="openItemModal('weapon')" title="Bro≈Ñ"><i class="fas fa-khanda"></i></div>
                <div class="equip-slot slot-legs" onclick="openItemModal('legs')" title="Buty"><i class="fas fa-socks"></i></div>

                <div class="pet-stage">
                    <!-- ACTIVE PET -->
                    <div id="activePetView" style="display:none; width:100%; display:flex; flex-direction:column; align-items:center;">
                        <div id="activePetIcon" class="pet-avatar"><i class="fas fa-cat"></i></div>
                        <div class="pet-info">
                            <div class="pet-name"><span id="activePetName">Name</span><span id="activePetLvl" class="pet-level-badge">LVL 1</span></div>
                            <div style="font-size:10px; color:#aaa; margin-bottom:5px;" id="activePetTier">TIER I</div>
                            <div class="pet-stats-bar"><div id="activePetXpBar" class="pet-stats-fill"></div></div>
                            <div style="font-size:10px; color:#94a3b8; margin-top:4px; display:flex; justify-content:space-between;"><span>XP</span><span id="activePetXpText">0/100</span></div>
                            
                            <button id="btnExpedition" class="btn-expedition" onclick="openExpeditionModal()">‚öîÔ∏è WYRUSZ NA WYPRAWƒò</button>
                            <button id="btnEvolve" class="btn-evolve" style="display:none;" onclick="evolvePet()">‚ú® EWOLUUJ (TIER UP)</button>
                        </div>
                    </div>
                    
                    <!-- ON EXPEDITION -->
                    <div id="onExpeditionView" style="display:none; text-align:center;">
                        <i class="fas fa-walking" style="font-size:50px; color:var(--accent); animation:floatPet 2s infinite;"></i>
                        <h3 style="color:white; margin:15px 0 5px;">Wyprawa w toku...</h3>
                        <div id="expeditionTimer" class="exp-timer-display">00:00</div>
                        <p style="font-size:11px; color:var(--text-muted);">Zwierzak walczy z potworami.</p>
                    </div>

                    <!-- EMPTY -->
                    <div id="emptySlotMsg" style="color:#94a3b8; font-weight:700; display:none;">Wybierz zwierzaka z magazynu</div>
                </div>
            </div>

            <div class="profile-section-title"><i class="fas fa-warehouse"></i> Magazyn Zwierzak√≥w</div>
            <div id="petsInventoryList" class="pets-inventory-list"></div>

            <div class="btn-petsdex" onclick="togglePetsdex()">
                <span><i class="fas fa-book"></i> PETSDEX</span>
                <i class="fas fa-chevron-down"></i>
            </div>
            <div id="pokedexGrid" class="pokedex-grid"></div>
        </div>
    </div>

    <!-- SHOP TAB -->
    <div id="shop" class="panel">
        <div class="protected-content">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2 style="margin:0; font-weight:900; letter-spacing:-1px; font-size:28px;">Sklep Gato.TV</h2>
                <button id="btnDaily" class="btn-daily" onclick="claimDailyBonus()"><i class="fas fa-gift"></i> ODBIERZ +10</button>
            </div>
            
            <div style="margin-bottom:30px;">
                <div class="chat-preview-container" onclick="togglePreviewTheme(this)">
                    <div class="chat-line">
                        <span class="chat-time">12:30</span>
                        <span class="chat-badges preview-badges"></span>
                        <span class="chat-username preview-user">Tw√≥jNick</span><span style="margin-right:4px;">:</span><span class="chat-msg">PodglƒÖd na ≈ºywo! Wybierz co≈õ dla siebie. ‚ú®</span>
                    </div>
                     <span style="font-size:10px; color:#64748b; margin-left:auto; cursor:pointer;">(Kliknij aby zmieniƒá motyw)</span>
                </div>
            </div>

            <div id="shopContent"></div>

            <div class="profile-section-title"><i class="fas fa-egg"></i> Jajka i Pety</div>
            <div class="egg-shop-section">
                <div class="egg-card" onclick="buyEgg()">
                    <div class="egg-icon"><i class="fas fa-egg"></i></div>
                    <div class="egg-title">STARTER EGG</div>
                    <div class="egg-price"><i class="fas fa-coins"></i> 100</div>
                    <div class="odds-display">
                        <span style="color:var(--tier1)">‚óè Kot / Pies (40%)</span><br>
                        <span style="color:var(--tier2)">‚óè Kr√≥lik (15%)</span><br>
                        <span style="color:var(--tier3)">‚óè Smok (5%)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- EMOTES / PREMIUM / DOWNLOAD (Standard panels kept) -->
    <div id="emotes" class="panel"> <div class="protected-content"><h2>Emotes</h2><p>Baza emotek.</p></div> </div>
    <div id="premium" class="panel"> <div class="wip-container"><i class="fas fa-hammer wip-icon"></i></div> </div>
    <div id="download" class="panel"> <div class="hero-card download-style"><h1>Pobierz Wtyczkƒô</h1><button class="btn-download-big">POBIERZ WTYCZKƒò</button></div> </div>

</div>

<!-- MODALS -->
<div id="modalExpedition" class="modal-wrap" style="display:none;">
    <div class="modal-box">
        <div class="modal-head"><button class="modal-close" onclick="closeExpeditionModal()">√ó</button><h2 style="color:white; margin:0;">Wybierz Wyprawƒô</h2></div>
        <div class="modal-content" style="padding:20px;">
            <div class="expedition-grid">
                <div class="exp-option" onclick="startExpedition(1)">
                    <div class="exp-info"><h4>üå≤ Spacer po Lesie</h4><p>≈Åatwy ‚Ä¢ 1 min</p></div>
                    <div class="exp-meta" style="color:var(--success)">80% Win</div>
                </div>
                <div class="exp-option" onclick="startExpedition(2)">
                    <div class="exp-info"><h4>ü¶á Mroczna Jaskinia</h4><p>≈öredni ‚Ä¢ 2 min</p></div>
                    <div class="exp-meta" style="color:var(--tier2)">50% Win</div>
                </div>
                <div class="exp-option" onclick="startExpedition(3)">
                    <div class="exp-info"><h4>üåã Wulkaniczna G√≥ra</h4><p>Trudny ‚Ä¢ 3 min</p></div>
                    <div class="exp-meta" style="color:var(--danger)">20% Win</div>
                </div>
            </div>
        </div>
    </div>
</div>

<div id="modalItems" class="modal-wrap" style="display:none;">
    <div class="modal-box">
        <div class="modal-head"><button class="modal-close" onclick="document.getElementById('modalItems').style.display='none'">√ó</button><h2 style="color:white; margin:0;">Ekwipunek</h2></div>
        <div class="modal-content">
            <div id="itemsGrid" class="item-grid"></div>
        </div>
    </div>
</div>

<!-- BOTTOM ELEMENTS -->
<div id="bottomLeftControls" class="fixed-bottom-controls">
    <div id="userRoleBadge" class="role-badge" style="display:none;">USER</div>
    <div id="btnConnections" class="connections-btn" style="display:none;" onclick="openConnectionsModal()">CONNECTIONS</div>
</div>
<div id="userProfileFloater" class="user-profile-floater" style="display:none;"><img id="floaterAvatar" class="floater-avatar" src=""><div class="floater-info"><span id="floaterName" class="floater-name">...</span><button class="btn-logout-mini" onclick="logout()">Wyloguj</button></div></div>

<script>
// CONFIG & STATE
const CLIENT_ID = 'l0agnxl8yeto7wda5wvblpg1mr55db';
const REDIRECT_URI = window.location.origin + window.location.pathname;
const DB_URL = "https://testowa-157aa-default-rtdb.europe-west1.firebasedatabase.app";
const ADMINS = ["gatojestemformaostateczna"]; 

let AppState = { 
    user: null, token: null, coins: 100, owned: [], loadout: {}, role: "USER", kickNick: null,
    activeSlotIndex: 0,
    equippedPets: [null, null, null], 
    petsInventory: [],
    itemsInventory: [], // [{id, type, name, bonus}]
    expedition: null // { petId, endTime, difficulty }
};

const PETS_DB = {
    'cat': { name: 'Kot', icon: 'fa-cat', rarity: 'common' },
    'dog': { name: 'Pies', icon: 'fa-dog', rarity: 'common' },
    'rabbit': { name: 'Kr√≥lik', icon: 'fa-carrot', rarity: 'rare' }, 
    'dragon': { name: 'Smok', icon: 'fa-dragon', rarity: 'legendary' }
};

const ITEMS_DB = [
    { type: 'head', name: 'Czapka Maga', icon: 'fa-hat-wizard', bonus: 10 },
    { type: 'chest', name: 'Zbroja P≈Çytowa', icon: 'fa-shield-alt', bonus: 15 },
    { type: 'weapon', name: 'Miecz Gato', icon: 'fa-khanda', bonus: 20 },
    { type: 'legs', name: 'Szybkie Buty', icon: 'fa-socks', bonus: 5 }
];

const CATALOG = [{ name: "Neon Blue", category:"paint", price: 40, type: "color", value: "#00ffff", previewStyle: "color:#00ffff" }]; // Shortened for brevity

// INIT
window.onload = async () => {
    try {
        const c = localStorage.getItem('gato_coins'); AppState.coins = c ? parseInt(c) : 100;
        const o = localStorage.getItem('gato_owned'); AppState.owned = o ? JSON.parse(o) : [];
        const pinv = localStorage.getItem('gato_pets_inv'); AppState.petsInventory = pinv ? JSON.parse(pinv) : [];
        const peq = localStorage.getItem('gato_pets_eq'); AppState.equippedPets = peq ? JSON.parse(peq) : [null, null, null];
        const items = localStorage.getItem('gato_items'); AppState.itemsInventory = items ? JSON.parse(items) : [];
        
        // Restore active expedition?
        const exp = localStorage.getItem('gato_expedition'); if(exp) AppState.expedition = JSON.parse(exp);
    } catch(e) {}
    
    updateCoinDisplay(); renderShop(); 
    if (location.hash.includes('access_token')) {
        const t = new URLSearchParams(location.hash.substring(1)).get('access_token');
        if(t) { localStorage.setItem('tw_token', t); history.replaceState({},document.title,location.pathname); await verifyToken(t); return; }
    }
    const t = localStorage.getItem('tw_token');
    if(t) await verifyToken(t); else showLoginScreen();
    
    setInterval(checkExpedition, 1000); // Expedition Timer Check
};

function loginWithTwitch() { location.href = `https://id.twitch.tv/oauth2/authorize?client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&response_type=token&scope=user:read:email`; }

async function verifyToken(t) {
    try {
        const r = await fetch('https://api.twitch.tv/helix/users', { headers: {'Client-ID': CLIENT_ID, 'Authorization': `Bearer ${t}`} });
        const d = await r.json();
        if(d.data && d.data[0]) {
            AppState.user = d.data[0]; AppState.token = t; showDashboard(AppState.user);
        } else throw 1;
    } catch(e) { localStorage.removeItem('tw_token'); showLoginScreen(); }
}

function logout() { localStorage.removeItem('tw_token'); location.reload(); }

// UI Logic
function showLoginScreen() { document.getElementById('loginBtnContainer').style.display='block'; document.querySelector('.protected-content').style.display='none'; }
function showDashboard(u) {
    document.getElementById('loginBtnContainer').style.display='none';
    document.querySelectorAll('.protected-content').forEach(e=>e.setAttribute('style','display:block !important'));
    document.getElementById('floaterAvatar').src = u.profile_image_url;
    document.getElementById('profileAvatarBig').src = u.profile_image_url;
    document.getElementById('profileNameBig').innerText = u.display_name;
    document.getElementById('userProfileFloater').style.display='flex';
    updatePetUI();
}

// --- PET SYSTEM LOGIC ---

function selectPetSlot(index) {
    AppState.activeSlotIndex = index;
    for(let i=0; i<3; i++) document.getElementById(`slot${i}`).className = i===index ? 'pet-slot-selector active' : 'pet-slot-selector';
    updatePetUI();
}

function equipPet(petId) {
    // Cannot change pet if currently exploring
    if(AppState.expedition && AppState.equippedPets[AppState.activeSlotIndex] === AppState.expedition.petId) {
        alert("Ten zwierzak jest na wyprawie!"); return;
    }
    const slot = AppState.activeSlotIndex;
    const existingIndex = AppState.equippedPets.indexOf(petId);
    if(existingIndex !== -1 && existingIndex !== slot) AppState.equippedPets[existingIndex] = null;
    AppState.equippedPets[slot] = petId;
    saveData();
    updatePetUI();
}

function updatePetUI() {
    // 1. Inventory List
    const invDiv = document.getElementById('petsInventoryList'); invDiv.innerHTML = '';
    AppState.petsInventory.forEach(p => {
        const isEquipped = AppState.equippedPets.includes(p.id);
        const div = document.createElement('div');
        div.className = `inv-pet-item ${isEquipped ? 'selected' : ''}`;
        const meta = PETS_DB[p.type];
        const color = p.tier === 1 ? 'var(--tier1)' : (p.tier === 2 ? 'var(--tier2)' : 'var(--tier3)');
        div.innerHTML = `<div class="inv-pet-tier" style="color:${color}">${"I".repeat(p.tier)}</div><div class="inv-pet-icon"><i class="fas ${meta.icon}" style="color:${color}"></i></div><div class="inv-pet-lvl">Lvl ${p.level}</div>`;
        div.onclick = () => equipPet(p.id);
        invDiv.appendChild(div);
    });

    // 2. Slot Icons
    for(let i=0; i<3; i++) {
        const pid = AppState.equippedPets[i];
        const el = document.getElementById(`slot${i}`);
        if(pid) {
            const p = AppState.petsInventory.find(x => x.id === pid);
            if(p) {
                const color = p.tier === 1 ? '#94a3b8' : (p.tier === 2 ? '#38bdf8' : '#facc15');
                el.innerHTML = `<i class="fas ${PETS_DB[p.type].icon}" style="color:${color}"></i>`;
            } else el.innerHTML = `<i class="fas fa-plus"></i>`;
        } else el.innerHTML = `<i class="fas fa-plus"></i>`;
    }

    // 3. Main Stage
    const activeId = AppState.equippedPets[AppState.activeSlotIndex];
    const activePet = activeId ? AppState.petsInventory.find(p => p.id === activeId) : null;
    const stage = document.getElementById('activePetView');
    const empty = document.getElementById('emptySlotMsg');
    const expedView = document.getElementById('onExpeditionView');
    const equipSlots = document.querySelectorAll('.equip-slot');

    if(activePet) {
        // Check if this specific pet is on expedition
        if(AppState.expedition && AppState.expedition.petId === activePet.id) {
            stage.style.display = 'none';
            empty.style.display = 'none';
            expedView.style.display = 'block';
            equipSlots.forEach(s => s.style.display='none');
        } else {
            stage.style.display = 'flex';
            empty.style.display = 'none';
            expedView.style.display = 'none';
            equipSlots.forEach(s => s.style.display='flex'); // Show equip slots

            const meta = PETS_DB[activePet.type];
            document.getElementById('activePetIcon').innerHTML = `<i class="fas ${meta.icon}"></i>`;
            document.getElementById('activePetIcon').className = `pet-avatar pet-tier-${activePet.tier}`;
            document.getElementById('activePetName').innerText = meta.name;
            document.getElementById('activePetLvl').innerText = `LVL ${activePet.level}`;
            document.getElementById('activePetTier').innerText = `TIER ${"I".repeat(activePet.tier)}`;
            
            const pct = Math.min(100, (activePet.xp / activePet.maxXp) * 100);
            document.getElementById('activePetXpBar').style.width = `${pct}%`;
            document.getElementById('activePetXpText').innerText = `${activePet.xp}/${activePet.maxXp}`;

            // Evolve Button
            const mate = AppState.petsInventory.find(p => p.type === activePet.type && p.tier === activePet.tier && p.id !== activePet.id);
            document.getElementById('btnEvolve').style.display = (mate && activePet.tier < 3) ? 'block' : 'none';

            // Update Equip Slots visuals
            ['head','chest','weapon','legs'].forEach(slot => {
                const sEl = document.querySelector(`.slot-${slot}`);
                if(activePet.equipment && activePet.equipment[slot]) {
                    sEl.classList.add('has-item');
                    sEl.innerHTML = '<i class="fas fa-check"></i>'; // Or specific icon
                } else {
                    sEl.classList.remove('has-item');
                    const icons = {head:'fa-hat-wizard', chest:'fa-tshirt', weapon:'fa-khanda', legs:'fa-socks'};
                    sEl.innerHTML = `<i class="fas ${icons[slot]}"></i>`;
                }
            });
        }
    } else {
        stage.style.display = 'none';
        empty.style.display = 'block';
        expedView.style.display = 'none';
        equipSlots.forEach(s => s.style.display='none');
    }
}

// EXPEDITION SYSTEM
function openExpeditionModal() {
    document.getElementById('modalExpedition').style.display = 'flex';
}
function closeExpeditionModal() {
    document.getElementById('modalExpedition').style.display = 'none';
}

function startExpedition(diff) {
    const activeId = AppState.equippedPets[AppState.activeSlotIndex];
    if(!activeId) return;
    
    // Duration in ms: 1min, 2min, 3min
    const durations = [60000, 120000, 180000]; 
    const duration = durations[diff-1];
    
    AppState.expedition = {
        petId: activeId,
        endTime: Date.now() + duration,
        difficulty: diff
    };
    
    localStorage.setItem('gato_expedition', JSON.stringify(AppState.expedition));
    closeExpeditionModal();
    updatePetUI();
}

function checkExpedition() {
    if(!AppState.expedition) return;
    
    const now = Date.now();
    const left = AppState.expedition.endTime - now;
    
    if(left <= 0) {
        finishExpedition();
    } else {
        // Update timer
        const mins = Math.floor(left / 60000);
        const secs = Math.floor((left % 60000) / 1000);
        const el = document.getElementById('expeditionTimer');
        if(el) el.innerText = `${mins}:${secs < 10 ? '0'+secs : secs}`;
    }
}

function finishExpedition() {
    const expData = AppState.expedition;
    AppState.expedition = null;
    localStorage.removeItem('gato_expedition');
    
    const pet = AppState.petsInventory.find(p => p.id === expData.petId);
    if(!pet) { updatePetUI(); return; } // Error handling
    
    // Win Chance Logic
    // Base: 80%, 50%, 20%
    let winChance = expData.difficulty === 1 ? 80 : (expData.difficulty === 2 ? 50 : 20);
    // Add bonuses from Level (+2% per lvl)
    winChance += pet.level * 2;
    // Add bonuses from Equipment
    if(pet.equipment) {
        Object.values(pet.equipment).forEach(item => { if(item) winChance += item.bonus; });
    }
    
    const roll = Math.random() * 100;
    const isWin = roll < winChance;
    
    let msg = "";
    if(isWin) {
        const xpGain = expData.difficulty * 100;
        const coinGain = expData.difficulty * 20;
        pet.xp += xpGain;
        AppState.coins += coinGain;
        
        msg = `üéâ WYPRAWA UDANA!\nZdobyto: ${xpGain} XP i ${coinGain} Coins.`;
        
        // Item Drop Chance (20%)
        if(Math.random() < 0.2) {
            const drop = ITEMS_DB[Math.floor(Math.random() * ITEMS_DB.length)];
            AppState.itemsInventory.push({...drop, id: Date.now()});
            msg += `\nüéÅ ZNALEZIONO PRZEDMIOT: ${drop.name}!`;
        }
        
        // Level Up Logic
        if(pet.xp >= pet.maxXp) {
            pet.level++;
            pet.xp -= pet.maxXp;
            pet.maxXp = Math.floor(pet.maxXp * 1.5);
            msg += `\nüÜô LEVEL UP! Tw√≥j zwierzak ma teraz poziom ${pet.level}!`;
        }
        fireConfetti(true);
    } else {
        msg = "üíÄ WYPRAWA NIEUDANA.\nTw√≥j zwierzak wr√≥ci≈Ç ranny, ale zdoby≈Ç 10 XP za pr√≥bƒô.";
        pet.xp += 10;
    }
    
    saveData();
    updateCoinDisplay();
    updatePetUI();
    alert(msg);
}

// EVOLUTION
function evolvePet() {
    const activeId = AppState.equippedPets[AppState.activeSlotIndex];
    if(!activeId) return;
    const mainPet = AppState.petsInventory.find(p => p.id === activeId);
    const mate = AppState.petsInventory.find(p => p.type === mainPet.type && p.tier === mainPet.tier && p.id !== mainPet.id);
    
    if(mate && confirm(`Ewoluowaƒá? Drugi zwierzak zniknie.`)) {
        AppState.petsInventory = AppState.petsInventory.filter(p => p.id !== mate.id); // Delete mate
        const mateIdx = AppState.equippedPets.indexOf(mate.id);
        if(mateIdx !== -1) AppState.equippedPets[mateIdx] = null;
        
        mainPet.tier++;
        saveData();
        updatePetUI();
        fireConfetti(true);
    }
}

// EQUIPMENT SYSTEM
window.openItemModal = function(slotType) {
    const activeId = AppState.equippedPets[AppState.activeSlotIndex];
    if(!activeId) return; // Must have pet selected
    if(AppState.expedition && AppState.expedition.petId === activeId) return; // Locked

    const modal = document.getElementById('modalItems');
    const grid = document.getElementById('itemsGrid');
    grid.innerHTML = '';
    
    // Filter items for this slot
    const validItems = AppState.itemsInventory.filter(i => i.type === slotType);
    
    if(validItems.length === 0) {
        grid.innerHTML = '<div style="grid-column:span 4; color:#999;">Brak przedmiot√≥w tego typu.</div>';
    } else {
        validItems.forEach(item => {
            const div = document.createElement('div');
            div.className = 'item-card';
            div.innerHTML = `<i class="fas ${item.icon}"></i><span>${item.name}</span><div style="font-size:9px;color:#0f0">+${item.bonus}% WIN</div>`;
            div.onclick = () => {
                equipItemToPet(activeId, slotType, item);
                modal.style.display = 'none';
            };
            grid.appendChild(div);
        });
    }
    modal.style.display = 'flex';
}

function equipItemToPet(petId, slot, item) {
    const pet = AppState.petsInventory.find(p => p.id === petId);
    if(!pet.equipment) pet.equipment = {};
    
    // If something equipped, return to inventory (conceptually simple swap)
    // Actually, items in itemsInventory are "unused". If we equip, we remove from array?
    // Let's keep it simple: Removing from global inv, attaching to pet.
    
    // Remove from global
    const idx = AppState.itemsInventory.findIndex(i => i.id === item.id);
    if(idx > -1) AppState.itemsInventory.splice(idx, 1);
    
    // If pet had item, put back to global
    if(pet.equipment[slot]) {
        AppState.itemsInventory.push(pet.equipment[slot]);
    }
    
    pet.equipment[slot] = item;
    saveData();
    updatePetUI();
}

// EGG BUYING
window.buyEgg = function() {
    if(AppState.coins < 100) { alert("Brak monet (100)"); return; }
    AppState.coins -= 100;
    updateCoinDisplay();
    
    const rand = Math.random() * 100;
    let type = 'cat';
    if(rand < 5) type = 'dragon'; else if(rand < 20) type = 'rabbit'; else if(rand < 60) type = 'dog';
    
    AppState.petsInventory.push({ id: Date.now(), type, tier: 1, level: 1, xp: 0, maxXp: 100, equipment: {} });
    saveData();
    updatePetUI();
    renderPokedex(); // If new pet type unlocked
    fireConfetti(true);
    alert(`Wyklu≈Ç siƒô: ${PETS_DB[type].name}!`);
}

// HELPERS
function saveData() {
    localStorage.setItem('gato_coins', AppState.coins);
    localStorage.setItem('gato_owned', JSON.stringify(AppState.owned));
    localStorage.setItem('gato_pets_inv', JSON.stringify(AppState.petsInventory));
    localStorage.setItem('gato_pets_eq', JSON.stringify(AppState.equippedPets));
    localStorage.setItem('gato_items', JSON.stringify(AppState.itemsInventory));
}
function updateCoinDisplay() { document.getElementById('coinCount').innerText = AppState.coins; saveData(); }
function fireConfetti(shop) { if(shop) confetti({particleCount:50,spread:60,origin:{x:0.5,y:0.5}}); }
window.togglePreviewTheme = function(el) { el.classList.toggle('light'); }
function renderShop() { /* Same as before but stripped down */ 
    const div = document.getElementById('shopContent'); div.innerHTML='';
    CATALOG.forEach(i=>{ /* Rendering logic from prev code */ });
}
function checkDailyBonus() { /* Same as before */ }
window.claimDailyBonus = function() { /* Same as before */ }
// ... (Standard tabs, profile rendering functions from previous answers remain unchanged for brevity, logic integrated above)
function renderPokedex() { /* Logic from prev answer */ }
window.togglePetsdex = function() {
    const grid = document.getElementById('pokedexGrid');
    grid.style.display = (grid.style.display==='none'||grid.style.display==='') ? 'grid' : 'none';
}
window.switchTab = function(id) { document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active')); document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active')); document.getElementById(id).classList.add('active'); event.target.classList.add('active'); }
window.switchProfileSubTab = function(tab) {
    document.getElementById('profileInventory').style.display = tab==='inventory'?'block':'none';
    document.getElementById('profileChannel').style.display = tab==='channel'?'block':'none';
}
</script>
</body>
</html>
